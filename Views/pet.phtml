<?php /** @var stdClass $view */ ?>
<?php require('template/header.phtml') ?>

    <main class="flex-grow-1">

        <?php
        // Check if the pet object failed to load (e.g., due to invalid ID)
        if ($view->pet == null):
            ?>
            <div class="alert alert-danger" role="alert">
                Pet not found or an error occurred.
            </div>
            <a href="listpets.php" class="btn btn-primary">Return to Pet List</a>
        <?php else: ?>
            <!-- Pet Details Section -->
            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h4 class="mb-0">Details for <?php echo htmlspecialchars($view->pet->getName()); ?> (ID: <?php echo $view->pet->getID(); ?>)</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Pet Image -->
                        <div class="col-md-4 mb-3">
                            <div class="card-img-container shadow-sm">
                                <img class="card-img-uniform" src="<?php echo $view->pet->getPhotoURL(); ?>" alt="<?php echo $view->pet->getName(); ?>">
                            </div>
                        </div>
                        <!-- Pet Info Table -->
                        <div class="col-md-8">
                            <table class="table table-bordered">
                                <tbody>
                                <tr>
                                    <th>Species</th>
                                    <td><?php echo htmlspecialchars($view->pet->getSpecies()); ?></td>
                                </tr>
                                <tr>
                                    <th>Breed</th>
                                    <td><?php echo htmlspecialchars($view->pet->getBreed()); ?></td>
                                </tr>
                                <tr>
                                    <th>Color</th>
                                    <td><?php echo htmlspecialchars($view->pet->getColor()); ?></td>
                                </tr>
                                <tr>
                                    <th>Status</th>
                                    <td>
                                        <?php
                                        // Display status badge based on the pet's current status
                                        if ($view->pet->getStatus() == 'lost'):
                                            ?>
                                            <span class="badge bg-danger">LOST ðŸ˜”</span>
                                        <?php else: ?>
                                            <span class="badge bg-success">FOUND ðŸ¥³</span>
                                        <?php endif; ?>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Reported</th>
                                    <td><?php echo $view->pet->getDateReported(); ?></td>
                                </tr>
                                </tbody>
                            </table>
                            <p class="mt-3"><strong>Description:</strong> <?php echo htmlspecialchars($view->pet->getDescription()); ?></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sighting Reports Section -->
            <h3 class="mt-5">Sighting History (<?php echo count($view->sightings); ?> Reports)</h3>
            <hr>

            <?php
            // Check if any sightings were reported for this pet
            if (empty($view->sightings)):
                ?>
                <div class="alert alert-warning">
                    No sightings have been reported for this pet yet.
                </div>
            <?php else: ?>
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-dark">
                        <tr>
                            <th scope="col">Reported By User ID</th>
                            <th scope="col">Comment</th>
                            <th scope="col">Location (Lat/Lon)</th>
                            <th scope="col">Time & Date</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?php
                        // Loop through and display each sighting report
                        foreach ($view->sightings as $sighting):
                            ?>
                            <tr>
                                <td><?php echo $sighting->getUserID(); ?></td>
                                <td><?php echo htmlspecialchars($sighting->getComment()); ?></td>
                                <td>
                                    Lat: <?php echo $sighting->getLatitude(); ?><br>
                                    Lon: <?php echo $sighting->getLongitude(); ?>
                                </td>
                                <td><?php echo $sighting->getTimestamp(); ?></td>
                            </tr>
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            <?php endif; ?>

        <?php endif; ?>
    </main>
<?php require('template/footer.phtml') ?>